#include "stdafx.h"
#include <SADXModLoader.h>
#include <lanternapi.h>
#include "Animals.h"
#include "Itembox.h"
#include "EmeShard.h"
#include "TornadoCrash.h"

DataPointer(float, EnvMap1, 0x038A5DD0);
DataPointer(float, EnvMap2, 0x038A5DE4);
DataPointer(float, EnvMap3, 0x038A5E00);
DataPointer(float, EnvMap4, 0x038A5E04);

NJS_MATERIAL* SecondCharacterSpecular[] = {
	//Emerald in the cutscene before Sonic-Gamma fight
	((NJS_MATERIAL*)0x02CD765C),
	((NJS_MATERIAL*)0x02CD7368),
	((NJS_MATERIAL*)0x02CD6F74),
	((NJS_MATERIAL*)0x02CD6920),
	//Tornado 2 transformed event model
	((NJS_MATERIAL*)0x032DAB24),
	((NJS_MATERIAL*)0x032DAB38),
	((NJS_MATERIAL*)0x032DBE24),
	((NJS_MATERIAL*)0x032DBE38),
	((NJS_MATERIAL*)0x032E7A48),
	((NJS_MATERIAL*)0x032E7A5C),
	((NJS_MATERIAL*)0x032E7A70),
	((NJS_MATERIAL*)0x032E7A84),
	((NJS_MATERIAL*)0x032E7A98),
	((NJS_MATERIAL*)0x032E7AAC),
	((NJS_MATERIAL*)0x032E7AC0),
	((NJS_MATERIAL*)0x032E7AD4),
	((NJS_MATERIAL*)0x032E7AE8),
	((NJS_MATERIAL*)0x032E7AFC),
	((NJS_MATERIAL*)0x032E7B10),
	((NJS_MATERIAL*)0x032E7B24),
	((NJS_MATERIAL*)0x032E7B38),
	((NJS_MATERIAL*)0x032E7B4C),
	((NJS_MATERIAL*)0x032E7B60),
	((NJS_MATERIAL*)0x032E7B74),
	((NJS_MATERIAL*)0x032E7B88),
	((NJS_MATERIAL*)0x032E7B9C),
	((NJS_MATERIAL*)0x032E7370),
	((NJS_MATERIAL*)0x032E7384),
	((NJS_MATERIAL*)0x032E7398),
	((NJS_MATERIAL*)0x032E73AC),
	((NJS_MATERIAL*)0x032E6E90),
	((NJS_MATERIAL*)0x032E6858),
	((NJS_MATERIAL*)0x032E686C),
	((NJS_MATERIAL*)0x032D6888),
	((NJS_MATERIAL*)0x032D689C),
	((NJS_MATERIAL*)0x032D68B0),
	((NJS_MATERIAL*)0x032D68C4),
	((NJS_MATERIAL*)0x032D6620),
	((NJS_MATERIAL*)0x032D6634),
	//Tornado 2 event model
	((NJS_MATERIAL*)0x02BF5DE0),
	((NJS_MATERIAL*)0x02BF5DF4),
	((NJS_MATERIAL*)0x02BF5E08),
	((NJS_MATERIAL*)0x02BF5E1C),
	((NJS_MATERIAL*)0x02BF5E30),
	((NJS_MATERIAL*)0x02BF5E44),
	((NJS_MATERIAL*)0x02BF5E58),
	((NJS_MATERIAL*)0x02BF5E6C),
	((NJS_MATERIAL*)0x02BF56E4),
	((NJS_MATERIAL*)0x02BF56F8),
	((NJS_MATERIAL*)0x02BF570C),
	((NJS_MATERIAL*)0x02BF547C),
	((NJS_MATERIAL*)0x02BF5490),
	((NJS_MATERIAL*)0x02BF5214),
	((NJS_MATERIAL*)0x02BF5228),
	((NJS_MATERIAL*)0x02C06848),
	((NJS_MATERIAL*)0x02C0685C),
	((NJS_MATERIAL*)0x02C06870),
	((NJS_MATERIAL*)0x02C06884),
	((NJS_MATERIAL*)0x02C06898),
	((NJS_MATERIAL*)0x02C068AC),
	((NJS_MATERIAL*)0x02C068C0),
	((NJS_MATERIAL*)0x02C068D4),
	((NJS_MATERIAL*)0x02C068E8),
	((NJS_MATERIAL*)0x02C068FC),
	((NJS_MATERIAL*)0x02C06910),
	((NJS_MATERIAL*)0x02C06924),
	((NJS_MATERIAL*)0x02C06938),
	((NJS_MATERIAL*)0x02C0694C),
	((NJS_MATERIAL*)0x02C06960),
	((NJS_MATERIAL*)0x02C06974),
	((NJS_MATERIAL*)0x02C06988),
	((NJS_MATERIAL*)0x02C0699C),
	((NJS_MATERIAL*)0x02C069B0),
	((NJS_MATERIAL*)0x02C069C4),
	((NJS_MATERIAL*)0x02C069D8),
	((NJS_MATERIAL*)0x02C069EC),
	((NJS_MATERIAL*)0x02C06A00),
	((NJS_MATERIAL*)0x02C06080),
	((NJS_MATERIAL*)0x02C06094),
	//Tornado 1 event model
	((NJS_MATERIAL*)0x0325D1B0),
	((NJS_MATERIAL*)0x0325D1C4),
	((NJS_MATERIAL*)0x0325D1D8),
	((NJS_MATERIAL*)0x0325D1EC),
	((NJS_MATERIAL*)0x0325D200),
	((NJS_MATERIAL*)0x0325D214),
	((NJS_MATERIAL*)0x0325D228),
	((NJS_MATERIAL*)0x0325D23C),
	((NJS_MATERIAL*)0x0325D250),
	((NJS_MATERIAL*)0x0325D264),
	((NJS_MATERIAL*)0x0325D278),
	((NJS_MATERIAL*)0x0325D28C),
	((NJS_MATERIAL*)0x0325D2A0),
	((NJS_MATERIAL*)0x0325D2B4),
	((NJS_MATERIAL*)0x0325D2C8),
	((NJS_MATERIAL*)0x0325D2DC),
	((NJS_MATERIAL*)0x0325D2F0),
	((NJS_MATERIAL*)0x0325D304),
	((NJS_MATERIAL*)0x0325D318),
	((NJS_MATERIAL*)0x0325D32C),
	((NJS_MATERIAL*)0x0325D340),
	((NJS_MATERIAL*)0x0325D354),
	((NJS_MATERIAL*)0x0325D368),
	((NJS_MATERIAL*)0x0325D37C),
	((NJS_MATERIAL*)0x0325D390),
	((NJS_MATERIAL*)0x0325D3A4),
	((NJS_MATERIAL*)0x0325D3B8),
	((NJS_MATERIAL*)0x0325D3CC),
	((NJS_MATERIAL*)0x0325D3E0),
	((NJS_MATERIAL*)0x0325D3F4),
	((NJS_MATERIAL*)0x0325D408),
	((NJS_MATERIAL*)0x0325D41C),
	((NJS_MATERIAL*)0x0325D430),
	((NJS_MATERIAL*)0x0325D444),
	((NJS_MATERIAL*)0x0325D458),
	((NJS_MATERIAL*)0x0325D46C),
	((NJS_MATERIAL*)0x0325D480),
	((NJS_MATERIAL*)0x0325D494),
	((NJS_MATERIAL*)0x0325D4A8),
	((NJS_MATERIAL*)0x0325D4BC),
	((NJS_MATERIAL*)0x0325C570),
	((NJS_MATERIAL*)0x0325C584),
	//Chaos 4 cutscene model
	((NJS_MATERIAL*)0x0302EB6C),
	((NJS_MATERIAL*)0x0302CB80),
	((NJS_MATERIAL*)0x0302CB94),
	((NJS_MATERIAL*)0x0302C610),
	((NJS_MATERIAL*)0x0302BF70),
	((NJS_MATERIAL*)0x0302BF84),
	((NJS_MATERIAL*)0x0302B980),
	((NJS_MATERIAL*)0x0302B680),
	((NJS_MATERIAL*)0x0302B110),
	((NJS_MATERIAL*)0x0302ACD8),
	((NJS_MATERIAL*)0x0302A8A4),
	((NJS_MATERIAL*)0x0302A420),
	((NJS_MATERIAL*)0x03029FE8),
	((NJS_MATERIAL*)0x03029D88),
	((NJS_MATERIAL*)0x03029950),
	((NJS_MATERIAL*)0x030296F0),
	((NJS_MATERIAL*)0x03028F08),
	((NJS_MATERIAL*)0x03028D50),
	((NJS_MATERIAL*)0x03028BD0),
	((NJS_MATERIAL*)0x03028A18),
	((NJS_MATERIAL*)0x03028898),
	((NJS_MATERIAL*)0x03027A4C),
	((NJS_MATERIAL*)0x030270C8),
	((NJS_MATERIAL*)0x03026BB0),
	((NJS_MATERIAL*)0x030269F8),
	((NJS_MATERIAL*)0x03026878),
	((NJS_MATERIAL*)0x03026360),
	((NJS_MATERIAL*)0x03025EF8),
	((NJS_MATERIAL*)0x03025AC0),
	((NJS_MATERIAL*)0x030256D8),
	((NJS_MATERIAL*)0x03025344),
	((NJS_MATERIAL*)0x03024F0C),
	((NJS_MATERIAL*)0x03024588),
	((NJS_MATERIAL*)0x03024070),
	((NJS_MATERIAL*)0x03023EB8),
	((NJS_MATERIAL*)0x03023D38),
	((NJS_MATERIAL*)0x03023820),
	((NJS_MATERIAL*)0x03023388),
	((NJS_MATERIAL*)0x03022F50),
	((NJS_MATERIAL*)0x03022B98),
	((NJS_MATERIAL*)0x03022804),
	((NJS_MATERIAL*)0x030223D0),
	//Chaos puddle in some cutscenes
	((NJS_MATERIAL*)0x02D64FD8),
	//Emeralds in pre-Chaos 4 cutscene
	((NJS_MATERIAL*)0x02D3F5A4),
	((NJS_MATERIAL*)0x02D3F2B0),
	((NJS_MATERIAL*)0x02D3EEBC),
	((NJS_MATERIAL*)0x02D3E868),
	//Emeralds in post-Casino cutscene
	((NJS_MATERIAL*)0x02D22A54),
	((NJS_MATERIAL*)0x02D22760),
	((NJS_MATERIAL*)0x02D2236C),
	((NJS_MATERIAL*)0x02D21D18),
	//Chaos 1
	((NJS_MATERIAL*)0x0318559C),
	((NJS_MATERIAL*)0x03184034),
	((NJS_MATERIAL*)0x03181F80),
	((NJS_MATERIAL*)0x03181F94),
	((NJS_MATERIAL*)0x03181990),
	((NJS_MATERIAL*)0x03181420),
	((NJS_MATERIAL*)0x03180D90),
	((NJS_MATERIAL*)0x03180DA4),
	((NJS_MATERIAL*)0x031807E8),
	((NJS_MATERIAL*)0x031805A0),
	((NJS_MATERIAL*)0x03180088),
	((NJS_MATERIAL*)0x0317FB70),
	((NJS_MATERIAL*)0x0317F600),
	((NJS_MATERIAL*)0x0317F0E8),
	((NJS_MATERIAL*)0x0317EBD0),
	((NJS_MATERIAL*)0x0317E6B8),
	((NJS_MATERIAL*)0x0317E1A0),
	((NJS_MATERIAL*)0x0317DFE8),
	((NJS_MATERIAL*)0x0317DE6C),
	((NJS_MATERIAL*)0x0317D620),
	((NJS_MATERIAL*)0x0317D108),
	((NJS_MATERIAL*)0x0317CD78),
	((NJS_MATERIAL*)0x0317C864),
	((NJS_MATERIAL*)0x0317C454),
	((NJS_MATERIAL*)0x0317C180),
	((NJS_MATERIAL*)0x0317BF38),
	((NJS_MATERIAL*)0x0317BAA0),
	((NJS_MATERIAL*)0x0317B8D4),
	((NJS_MATERIAL*)0x0317B620),
	((NJS_MATERIAL*)0x0317B0E0),
	((NJS_MATERIAL*)0x0317AEAC),
	((NJS_MATERIAL*)0x0317AB18),
	((NJS_MATERIAL*)0x0317A948),
	((NJS_MATERIAL*)0x0317A778),
	((NJS_MATERIAL*)0x0317A370),
	((NJS_MATERIAL*)0x0317A13C),
	((NJS_MATERIAL*)0x03179D80),
	((NJS_MATERIAL*)0x03179BB0),
	((NJS_MATERIAL*)0x031799E0),
	//Eggman in Eggmobile in cutscenes
	((NJS_MATERIAL*)0x02EE8418),
	((NJS_MATERIAL*)0x02EE842C),
	((NJS_MATERIAL*)0x02EE8440),
	((NJS_MATERIAL*)0x02EE8454),
	((NJS_MATERIAL*)0x02EE8468),
	((NJS_MATERIAL*)0x02EE847C),
	((NJS_MATERIAL*)0x02EE8490),
	((NJS_MATERIAL*)0x02EE84A4),
	((NJS_MATERIAL*)0x02EE84B8),
	((NJS_MATERIAL*)0x02EE84CC),
	((NJS_MATERIAL*)0x02EE84E0),
	((NJS_MATERIAL*)0x02EE84F4),
	((NJS_MATERIAL*)0x02EE8508),
	((NJS_MATERIAL*)0x02EE851C),
	((NJS_MATERIAL*)0x02EE8530),
	((NJS_MATERIAL*)0x02EE8544),
	((NJS_MATERIAL*)0x02EE8558),
	((NJS_MATERIAL*)0x02EE856C),
	((NJS_MATERIAL*)0x02EE8580),
	((NJS_MATERIAL*)0x02EE8594),
	((NJS_MATERIAL*)0x02EE85A8),
	((NJS_MATERIAL*)0x02EE85BC),
	((NJS_MATERIAL*)0x02EE85D0),
	((NJS_MATERIAL*)0x02EE85E4),
	((NJS_MATERIAL*)0x02EE7840),
	((NJS_MATERIAL*)0x02EE7854),
	((NJS_MATERIAL*)0x02EE7868),
	((NJS_MATERIAL*)0x02EE787C),
	((NJS_MATERIAL*)0x02EE7890),
	((NJS_MATERIAL*)0x02EE4B30),
	((NJS_MATERIAL*)0x02EE4410),
	((NJS_MATERIAL*)0x02EE4424),
	((NJS_MATERIAL*)0x02EE4438),
	((NJS_MATERIAL*)0x02EE444C),
	((NJS_MATERIAL*)0x02EE4460),
	((NJS_MATERIAL*)0x02EE2F48),
	((NJS_MATERIAL*)0x02EE2828),
	((NJS_MATERIAL*)0x02EE283C),
	((NJS_MATERIAL*)0x02EE2850),
	((NJS_MATERIAL*)0x02EE2864),
	((NJS_MATERIAL*)0x02EE2878),
	((NJS_MATERIAL*)0x02EE15B8),
	((NJS_MATERIAL*)0x02EE12FC),
	((NJS_MATERIAL*)0x02EE1210),
	((NJS_MATERIAL*)0x02EE1110),
	((NJS_MATERIAL*)0x02EE1124),
	((NJS_MATERIAL*)0x02EE0FE8),
	((NJS_MATERIAL*)0x02EE0FFC),
	((NJS_MATERIAL*)0x02EE1010),
	((NJS_MATERIAL*)0x02EE1024),
	((NJS_MATERIAL*)0x02EE0ED4),
	((NJS_MATERIAL*)0x02EE0EE8),
	((NJS_MATERIAL*)0x02EE0EFC),
	((NJS_MATERIAL*)0x02EE0DE8),
	((NJS_MATERIAL*)0x02EE0CE8),
	((NJS_MATERIAL*)0x02EE0CFC),
	((NJS_MATERIAL*)0x02EE0BC0),
	((NJS_MATERIAL*)0x02EE0BD4),
	((NJS_MATERIAL*)0x02EE0BE8),
	((NJS_MATERIAL*)0x02EE0BFC),
	((NJS_MATERIAL*)0x02EE0AAC),
	((NJS_MATERIAL*)0x02EE0AC0),
	((NJS_MATERIAL*)0x02EE0AD4),
	//Emerald in Tails' poolside cutscene
	((NJS_MATERIAL*)0x02CF205C),
	((NJS_MATERIAL*)0x02CF1D68),
	((NJS_MATERIAL*)0x02CF1974),
	((NJS_MATERIAL*)0x02CF1320),
	//Eggman
	((NJS_MATERIAL*)0x0089C768),
	((NJS_MATERIAL*)0x0089B788),
	((NJS_MATERIAL*)0x0089B79C),
	((NJS_MATERIAL*)0x0089B7B0),
	((NJS_MATERIAL*)0x0089B7C4),
	((NJS_MATERIAL*)0x0089B7D8),
	((NJS_MATERIAL*)0x0089B7EC),
	((NJS_MATERIAL*)0x00898A78),
	((NJS_MATERIAL*)0x00898358),
	((NJS_MATERIAL*)0x0089836C),
	((NJS_MATERIAL*)0x00898380),
	((NJS_MATERIAL*)0x00898394),
	((NJS_MATERIAL*)0x008983A8),
	((NJS_MATERIAL*)0x00896E68),
	((NJS_MATERIAL*)0x00896748),
	((NJS_MATERIAL*)0x0089675C),
	((NJS_MATERIAL*)0x00896770),
	((NJS_MATERIAL*)0x00896784),
	((NJS_MATERIAL*)0x00896798),
	((NJS_MATERIAL*)0x008952E4),
	((NJS_MATERIAL*)0x00894A38),
	((NJS_MATERIAL*)0x008946F4),
	((NJS_MATERIAL*)0x00894414),
	((NJS_MATERIAL*)0x00894428),
	((NJS_MATERIAL*)0x00893DF0),
	((NJS_MATERIAL*)0x00893E04),
	((NJS_MATERIAL*)0x00893E18),
	((NJS_MATERIAL*)0x00893E2C),
	((NJS_MATERIAL*)0x00893A38),
	((NJS_MATERIAL*)0x00893A4C),
	((NJS_MATERIAL*)0x00893A60),
	((NJS_MATERIAL*)0x008936F4),
	((NJS_MATERIAL*)0x00893404),
	((NJS_MATERIAL*)0x00893418),
	((NJS_MATERIAL*)0x00892DE0),
	((NJS_MATERIAL*)0x00892DF4),
	((NJS_MATERIAL*)0x00892E08),
	((NJS_MATERIAL*)0x00892E1C),
	((NJS_MATERIAL*)0x00892A28),
	((NJS_MATERIAL*)0x00892A3C),
	((NJS_MATERIAL*)0x00892A50),
};

NJS_MATERIAL* FirstCharacterSpecular[] = {
	//Tikal in the EXE
	((NJS_MATERIAL*)0x008D4228),
	((NJS_MATERIAL*)0x008D423C),
	((NJS_MATERIAL*)0x008D4250),
	((NJS_MATERIAL*)0x008D4264),
	((NJS_MATERIAL*)0x008D4048),
	((NJS_MATERIAL*)0x008D405C),
	((NJS_MATERIAL*)0x008D3E7C),
	((NJS_MATERIAL*)0x008D39B0),
	((NJS_MATERIAL*)0x008D3700),
	((NJS_MATERIAL*)0x008D3540),
	((NJS_MATERIAL*)0x008D3310),
	((NJS_MATERIAL*)0x008D3168),
	((NJS_MATERIAL*)0x008D2D38),
	((NJS_MATERIAL*)0x008D2A88),
	((NJS_MATERIAL*)0x008D28E0),
	((NJS_MATERIAL*)0x008D26A0),
	((NJS_MATERIAL*)0x008D24F8),
	((NJS_MATERIAL*)0x008D2044),
	((NJS_MATERIAL*)0x008D2058),
	((NJS_MATERIAL*)0x008D206C),
	((NJS_MATERIAL*)0x008D1D08),
	((NJS_MATERIAL*)0x008D1A68),
	((NJS_MATERIAL*)0x008CFB18),
	((NJS_MATERIAL*)0x008CFB2C),
	((NJS_MATERIAL*)0x008CFB40),
	((NJS_MATERIAL*)0x008CFB54),
	((NJS_MATERIAL*)0x008CFB68),
	((NJS_MATERIAL*)0x008CF3B0),
	((NJS_MATERIAL*)0x008CF178),
	((NJS_MATERIAL*)0x008CEF40),
	((NJS_MATERIAL*)0x008CECCC),
	((NJS_MATERIAL*)0x008CE08C),
	((NJS_MATERIAL*)0x008CDE48),
	((NJS_MATERIAL*)0x008CDB48),
	((NJS_MATERIAL*)0x008CD6E8),
	((NJS_MATERIAL*)0x008CD6FC),
	((NJS_MATERIAL*)0x008CD4F4),
	((NJS_MATERIAL*)0x008CD508),
	((NJS_MATERIAL*)0x008CD2E4),
	((NJS_MATERIAL*)0x008CC68C),
	((NJS_MATERIAL*)0x008CC448),
	((NJS_MATERIAL*)0x008CC158),
	((NJS_MATERIAL*)0x008CBD08),
	((NJS_MATERIAL*)0x008CBD1C),
	((NJS_MATERIAL*)0x008CBB14),
	((NJS_MATERIAL*)0x008CBB28),
	((NJS_MATERIAL*)0x008CB918),
	((NJS_MATERIAL*)0x008CB6E8),
	//Tornado 2 transformed event model
	((NJS_MATERIAL*)0x032E3428),
	((NJS_MATERIAL*)0x032E343C),
	((NJS_MATERIAL*)0x032E3450),
	((NJS_MATERIAL*)0x032E3464),
	((NJS_MATERIAL*)0x032E28A0),
	((NJS_MATERIAL*)0x032E2288),
	((NJS_MATERIAL*)0x032E229C),
	((NJS_MATERIAL*)0x032E20DC),
	((NJS_MATERIAL*)0x032E1558),
	((NJS_MATERIAL*)0x032E0F40),
	((NJS_MATERIAL*)0x032E0F54),
	((NJS_MATERIAL*)0x032E0D94),
	((NJS_MATERIAL*)0x032E03A4),
	((NJS_MATERIAL*)0x032DC890),
	((NJS_MATERIAL*)0x032DC8A4),
	((NJS_MATERIAL*)0x032DC8B8),
	((NJS_MATERIAL*)0x032DC8CC),
	((NJS_MATERIAL*)0x032DC8E0),
	((NJS_MATERIAL*)0x032DB720),
	((NJS_MATERIAL*)0x032DB734),
	((NJS_MATERIAL*)0x032DB748),
	((NJS_MATERIAL*)0x032DB590),
	((NJS_MATERIAL*)0x032DA438),
	((NJS_MATERIAL*)0x032DA44C),
	((NJS_MATERIAL*)0x032DA460),
	((NJS_MATERIAL*)0x032DA2A4),
	((NJS_MATERIAL*)0x032D96F0),
	((NJS_MATERIAL*)0x032D9704),
	((NJS_MATERIAL*)0x032D9070),
	((NJS_MATERIAL*)0x032D9084),
	((NJS_MATERIAL*)0x032D9098),
	((NJS_MATERIAL*)0x032D8EC4),
	((NJS_MATERIAL*)0x032D8328),
	((NJS_MATERIAL*)0x032D833C),
	((NJS_MATERIAL*)0x032D7CA8),
	((NJS_MATERIAL*)0x032D7CBC),
	((NJS_MATERIAL*)0x032D7CD0),
	((NJS_MATERIAL*)0x032D7B00),
	((NJS_MATERIAL*)0x032D78D0),
	((NJS_MATERIAL*)0x032D6CF0),
	((NJS_MATERIAL*)0x032D6D04),
	//Tornado 2 event model
	((NJS_MATERIAL*)0x02C02C60),
	((NJS_MATERIAL*)0x02C02C74),
	((NJS_MATERIAL*)0x02C02C88),
	((NJS_MATERIAL*)0x02C02C9C),
	((NJS_MATERIAL*)0x02C020E8),
	((NJS_MATERIAL*)0x02C01AD0),
	((NJS_MATERIAL*)0x02C01AE4),
	((NJS_MATERIAL*)0x02C01924),
	((NJS_MATERIAL*)0x02C00D98),
	((NJS_MATERIAL*)0x02C00780),
	((NJS_MATERIAL*)0x02C00794),
	((NJS_MATERIAL*)0x02C005D4),
	((NJS_MATERIAL*)0x02BFFBE4),
	((NJS_MATERIAL*)0x02BFC110),
	((NJS_MATERIAL*)0x02BFC124),
	((NJS_MATERIAL*)0x02BFC138),
	((NJS_MATERIAL*)0x02BFC14C),
	((NJS_MATERIAL*)0x02BFC160),
	((NJS_MATERIAL*)0x02BFB6A4),
	((NJS_MATERIAL*)0x02BFB6B8),
	((NJS_MATERIAL*)0x02BFAFA0),
	((NJS_MATERIAL*)0x02BFAFB4),
	((NJS_MATERIAL*)0x02BFAFC8),
	((NJS_MATERIAL*)0x02BFAE10),
	((NJS_MATERIAL*)0x02BFA3A4),
	((NJS_MATERIAL*)0x02BFA3B8),
	((NJS_MATERIAL*)0x02BF9CB8),
	((NJS_MATERIAL*)0x02BF9CCC),
	((NJS_MATERIAL*)0x02BF9CE0),
	((NJS_MATERIAL*)0x02BF9B24),
	((NJS_MATERIAL*)0x02BF8F88),
	((NJS_MATERIAL*)0x02BF8F9C),
	((NJS_MATERIAL*)0x02BF8908),
	((NJS_MATERIAL*)0x02BF891C),
	((NJS_MATERIAL*)0x02BF8930),
	((NJS_MATERIAL*)0x02BF875C),
	((NJS_MATERIAL*)0x02BF7BB8),
	((NJS_MATERIAL*)0x02BF7BCC),
	((NJS_MATERIAL*)0x02BF7538),
	((NJS_MATERIAL*)0x02BF754C),
	((NJS_MATERIAL*)0x02BF7560),
	((NJS_MATERIAL*)0x02BF7390),
	((NJS_MATERIAL*)0x02BF7160),
	((NJS_MATERIAL*)0x02BF6508),
	((NJS_MATERIAL*)0x02BF651C),
	((NJS_MATERIAL*)0x02BF6530),
	//Tornado 1 event model
	((NJS_MATERIAL*)0x0325C988),
	((NJS_MATERIAL*)0x0325C99C),
	((NJS_MATERIAL*)0x03259198),
	((NJS_MATERIAL*)0x032591AC),
	((NJS_MATERIAL*)0x032591C0),
	((NJS_MATERIAL*)0x032591D4),
	((NJS_MATERIAL*)0x03258610),
	((NJS_MATERIAL*)0x03257FF8),
	((NJS_MATERIAL*)0x0325800C),
	((NJS_MATERIAL*)0x03257E4C),
	((NJS_MATERIAL*)0x032572E8),
	((NJS_MATERIAL*)0x03256CD0),
	((NJS_MATERIAL*)0x03256CE4),
	((NJS_MATERIAL*)0x03256B24),
	((NJS_MATERIAL*)0x03256134),
	((NJS_MATERIAL*)0x03252660),
	((NJS_MATERIAL*)0x03252674),
	((NJS_MATERIAL*)0x03252688),
	((NJS_MATERIAL*)0x0325269C),
	((NJS_MATERIAL*)0x032526B0),
	((NJS_MATERIAL*)0x03251BF4),
	((NJS_MATERIAL*)0x03251C08),
	((NJS_MATERIAL*)0x032514F0),
	((NJS_MATERIAL*)0x03251504),
	((NJS_MATERIAL*)0x03251518),
	((NJS_MATERIAL*)0x03251360),
	((NJS_MATERIAL*)0x032508F4),
	((NJS_MATERIAL*)0x03250908),
	((NJS_MATERIAL*)0x03250208),
	((NJS_MATERIAL*)0x0325021C),
	((NJS_MATERIAL*)0x03250230),
	((NJS_MATERIAL*)0x03250074),
	((NJS_MATERIAL*)0x0324F4C0),
	((NJS_MATERIAL*)0x0324F4D4),
	((NJS_MATERIAL*)0x0324EE40),
	((NJS_MATERIAL*)0x0324EE54),
	((NJS_MATERIAL*)0x0324EE68),
	((NJS_MATERIAL*)0x0324EC94),
	((NJS_MATERIAL*)0x0324E0F0),
	((NJS_MATERIAL*)0x0324E104),
	((NJS_MATERIAL*)0x0324DA70),
	((NJS_MATERIAL*)0x0324DA84),
	((NJS_MATERIAL*)0x0324DA98),
	((NJS_MATERIAL*)0x0324D8C8),
	((NJS_MATERIAL*)0x0324D698),
	((NJS_MATERIAL*)0x0324CA54),
	((NJS_MATERIAL*)0x0324CA68),
	((NJS_MATERIAL*)0x0324CA7C),
	//Eggman in Eggmobile in cutscenes
	//Left hand
	((NJS_MATERIAL*)0x02EE25E0),
	((NJS_MATERIAL*)0x02EE22F4),
	((NJS_MATERIAL*)0x02EE1838),
	//Right hand
	((NJS_MATERIAL*)0x02EE41C8),
	((NJS_MATERIAL*)0x02EE3ECC),
	((NJS_MATERIAL*)0x02EE342C),
	//Head and moustache
	((NJS_MATERIAL*)0x02EE58C0),
	((NJS_MATERIAL*)0x02EE58D4),
	((NJS_MATERIAL*)0x02EE58E8),
	((NJS_MATERIAL*)0x02EE58FC),
	((NJS_MATERIAL*)0x02EE5910),
	((NJS_MATERIAL*)0x02EE5924),
	((NJS_MATERIAL*)0x02EE5014),
	//Eggman normal
	//Eggman left hand
	((NJS_MATERIAL*)0x00896500),
	((NJS_MATERIAL*)0x00896214),
	((NJS_MATERIAL*)0x00895748),
	//Eggman right hand
	((NJS_MATERIAL*)0x00898110),
	((NJS_MATERIAL*)0x00897E14),
	((NJS_MATERIAL*)0x0089734C),
	//Eggman head and moustache
	((NJS_MATERIAL*)0x00899808),
	((NJS_MATERIAL*)0x0089981C),
	((NJS_MATERIAL*)0x00899830),
	((NJS_MATERIAL*)0x00899844),
	((NJS_MATERIAL*)0x00899858),
	((NJS_MATERIAL*)0x0089986C),
	((NJS_MATERIAL*)0x00898F5C),
};

NJS_MATERIAL* ObjectSpecular[] = { 
	//ZERO cutscene model
	((NJS_MATERIAL*)0x00990FE0),
	((NJS_MATERIAL*)0x00990FF4),
	((NJS_MATERIAL*)0x00990BC0),
	((NJS_MATERIAL*)0x00990BD4),
	((NJS_MATERIAL*)0x00990BE8),
	((NJS_MATERIAL*)0x00990BFC),
	((NJS_MATERIAL*)0x00990C10),
	((NJS_MATERIAL*)0x00990420),
	((NJS_MATERIAL*)0x00990434),
	((NJS_MATERIAL*)0x00990448),
	((NJS_MATERIAL*)0x0099045C),
	((NJS_MATERIAL*)0x00990470),
	((NJS_MATERIAL*)0x0098FC60),
	((NJS_MATERIAL*)0x0098FC74),
	((NJS_MATERIAL*)0x0098F558),
	((NJS_MATERIAL*)0x0098F56C),
	((NJS_MATERIAL*)0x0098F580),
	((NJS_MATERIAL*)0x0098F594),
	((NJS_MATERIAL*)0x0098F5A8),
	((NJS_MATERIAL*)0x0098F5BC),
	((NJS_MATERIAL*)0x0098EE50),
	((NJS_MATERIAL*)0x0098EE64),
	((NJS_MATERIAL*)0x0098EE78),
	((NJS_MATERIAL*)0x0098EE8C),
	((NJS_MATERIAL*)0x0098EEA0),
	((NJS_MATERIAL*)0x0098EEB4),
	((NJS_MATERIAL*)0x0098D218),
	((NJS_MATERIAL*)0x0098D22C),
	((NJS_MATERIAL*)0x0098D240),
	((NJS_MATERIAL*)0x0098D254),
	((NJS_MATERIAL*)0x0098D268),
	((NJS_MATERIAL*)0x0098D27C),
	((NJS_MATERIAL*)0x0098D290),
	((NJS_MATERIAL*)0x0098D2A4),
	((NJS_MATERIAL*)0x0098D2B8),
	((NJS_MATERIAL*)0x0098D2CC),
	((NJS_MATERIAL*)0x0098D2E0),
	((NJS_MATERIAL*)0x0098D2F4),
	((NJS_MATERIAL*)0x0098D308),
	((NJS_MATERIAL*)0x0098D31C),
	((NJS_MATERIAL*)0x0098D330),
	((NJS_MATERIAL*)0x0098CE30),
	((NJS_MATERIAL*)0x0098CE44),
	((NJS_MATERIAL*)0x0098CB90),
	((NJS_MATERIAL*)0x0098CBA4),
	((NJS_MATERIAL*)0x0098C868),
	((NJS_MATERIAL*)0x0098C87C),
	((NJS_MATERIAL*)0x0098C890),
	((NJS_MATERIAL*)0x0098C550),
	((NJS_MATERIAL*)0x0098C564),
	((NJS_MATERIAL*)0x0098C578),
	((NJS_MATERIAL*)0x0098C140),
	((NJS_MATERIAL*)0x0098C154),
	((NJS_MATERIAL*)0x0098C168),
	((NJS_MATERIAL*)0x0098BF50),
	((NJS_MATERIAL*)0x0098BDA4),
	((NJS_MATERIAL*)0x0098B9C0),
	((NJS_MATERIAL*)0x0098B9D4),
	((NJS_MATERIAL*)0x0098B720),
	((NJS_MATERIAL*)0x0098B734),
	((NJS_MATERIAL*)0x0098B3F8),
	((NJS_MATERIAL*)0x0098B40C),
	((NJS_MATERIAL*)0x0098B420),
	((NJS_MATERIAL*)0x0098B0E0),
	((NJS_MATERIAL*)0x0098B0F4),
	((NJS_MATERIAL*)0x0098B108),
	((NJS_MATERIAL*)0x0098ACD0),
	((NJS_MATERIAL*)0x0098ACE4),
	((NJS_MATERIAL*)0x0098ACF8),
	((NJS_MATERIAL*)0x0098AAE0),
	((NJS_MATERIAL*)0x0098A924),
	((NJS_MATERIAL*)0x0098A2B0),
	((NJS_MATERIAL*)0x0098A2C4),
	((NJS_MATERIAL*)0x0098A2D8),
	((NJS_MATERIAL*)0x0098A2EC),
	((NJS_MATERIAL*)0x0098A300),
	((NJS_MATERIAL*)0x00989F70),
	((NJS_MATERIAL*)0x00989F84),
	((NJS_MATERIAL*)0x00989F98),
	((NJS_MATERIAL*)0x00989C30),
	((NJS_MATERIAL*)0x00989C44),
	((NJS_MATERIAL*)0x00989C58),
	((NJS_MATERIAL*)0x009899C0),
	((NJS_MATERIAL*)0x009899D4),
	((NJS_MATERIAL*)0x00989750),
	((NJS_MATERIAL*)0x00989764),
};

bool ForceObjectSpecular(NJS_MATERIAL* material, Uint32 flags)
{
	set_diffuse(0, false);
	set_specular(1, false);
	use_default_diffuse(true);
	return true;
}

bool ForceFirstCharacterSpecular(NJS_MATERIAL* material, Uint32 flags)
{
	set_diffuse(2, false);
	set_specular(2, false);
	use_default_diffuse(true);
	return true;
}

bool ForceSecondCharacterSpecular(NJS_MATERIAL* material, Uint32 flags)
{
	set_diffuse(2, false);
	set_specular(3, false);
	use_default_diffuse(true);
	return true;
}

void __cdecl FixedBubbleRipple(ObjectMaster *a1)
{
	DataPointer(int, MissedFrames, 0x03B1117C);
	DataPointer(D3DCOLORVALUE, stru_3D0B7C8, 0x3D0B7C8);
	DataPointer(NJS_OBJECT, stru_8B22F4, 0x8B22F4);
	NJS_VECTOR *v1; // esi@1
	double v2; // st7@2
	v1 = (NJS_VECTOR *)a1->UnknownB_ptr;
	if (!MissedFrames)
	{
		SetTextureToCommon();
		njPushMatrix(0);
		njTranslateV(0, v1);
		BackupConstantAttr();
		AddConstantAttr(0, NJD_FLAG_USE_ALPHA);
		v2 = v1[1].z;
		stru_3D0B7C8.g = v1[1].z;
		stru_3D0B7C8.b = v2;
		stru_3D0B7C8.a = v2;
		SetMaterialAndSpriteColor((NJS_ARGB *)&stru_3D0B7C8);
		njColorBlendingMode(0, NJD_COLOR_BLENDING_SRCALPHA);
		njColorBlendingMode(NJD_DESTINATION_COLOR, NJD_COLOR_BLENDING_ONE);
		njScale(0, v1[2].z, 1.0f, v1[2].z);
		SomeDepthThing = -17952;
		ProcessModelNode_A_WrapperB(&stru_8B22F4, (QueuedModelFlagsB)0);
		SomeDepthThing = 0;
		ClampGlobalColorThing_Thing();
		njColorBlendingMode(0, NJD_COLOR_BLENDING_SRCALPHA);
		njColorBlendingMode(NJD_DESTINATION_COLOR, NJD_COLOR_BLENDING_INVSRCALPHA);
		RestoreConstantAttr();
		njPopMatrix(1u);
	}
}

static PointerInfo jumps[] = {
	// ItemBox
	{ ItemBox_Display_Destroyed,	ItemBox_Display_Destroyed_Rotate },
	{ ItemBox_Display_Unknown,		ItemBox_Display_Unknown_Rotate },
	{ ItemBox_Display,				ItemBox_Display_Rotate },
};

extern "C"
{
	__declspec(dllexport) PointerList Jumps[] = { { arrayptrandlength(jumps) } };
	__declspec(dllexport) ModInfo SADXModInfo = { ModLoaderVer };
	__declspec(dllexport) void __cdecl Init()
	{
		WriteJump((void*)0x7A81A0, FixedBubbleRipple);
		HMODULE Lantern = GetModuleHandle(L"sadx-dc-lighting");
		if (Lantern != nullptr && GetProcAddress(Lantern, "allow_landtable_specular") != nullptr)
		{
			allow_landtable_specular(true);
			allow_object_vcolor(false);
			material_register(FirstCharacterSpecular, LengthOfArray(FirstCharacterSpecular), &ForceFirstCharacterSpecular);
			material_register(SecondCharacterSpecular, LengthOfArray(SecondCharacterSpecular), &ForceSecondCharacterSpecular);
			material_register(ObjectSpecular, LengthOfArray(ObjectSpecular), &ForceObjectSpecular);
		}
		((NJS_OBJECT*)0x10D7774)->basicdxmodel->mats[0].diffuse.color = 0xFFB2B2B2; //Question mark from Character Select
		((NJS_OBJECT*)0x10D7774)->basicdxmodel->mats[0].attr_texId = 10; //Question mark from Character Select
		//Item capsule lighting fixes
		((NJS_MODEL*)0x008BF260)->mats[0].attrflags |= NJD_FLAG_IGNORE_SPECULAR;
		((NJS_MODEL*)0x008BF260)->mats[1].attrflags |= NJD_FLAG_IGNORE_SPECULAR;
		((NJS_MODEL*)0x008BF260)->mats[2].attrflags |= NJD_FLAG_IGNORE_SPECULAR;
		((NJS_MODEL*)0x008BF260)->mats[3].attrflags |= NJD_FLAG_IGNORE_SPECULAR;
		((NJS_MODEL*)0x008BEAA8)->mats[0].attrflags |= NJD_FLAG_IGNORE_SPECULAR;
		((NJS_MODEL*)0x008BE620)->mats[0].attrflags |= NJD_FLAG_IGNORE_SPECULAR;
		((NJS_MODEL*)0x008BE620)->mats[1].attrflags |= NJD_FLAG_IGNORE_SPECULAR; //end
		//((NJS_OBJECT*)0x008BE194)->basicdxmodel->mats[0].diffuse.argb.a = 0xB2; //Balloon transparency
		//((NJS_OBJECT*)0x008BE194)->basicdxmodel->mats[1].diffuse.argb.a = 0xB2; //Balloon transparency
		WriteData((char*)0x004D7712, 2, 1); //Animal bubble blending mode
		WriteData((char*)0x004A2DBB, 1, 1); //Emerald piece blending mode
		*(NJS_OBJECT*)0x008BA6D4 = object_0019BC48; //Emerald piece
		*(NJS_OBJECT*)0x02F67B78 = object_0021BD90; //Tornado 2 crashed
		ResizeTextureList((NJS_TEXLIST*)0x0092ACE4, 5); //GOMA texlist
		((NJS_OBJECT*)0x929E1C)->model = &attach_001568D8; //Goma left whisker
		((NJS_OBJECT*)0x929FD8)->model = &attach_00156758; //Goma right whisker
		((NJS_OBJECT*)0x929760)->model = &attach_00157668; //Goma body
		((NJS_OBJECT*)0x929AA4)->model = &attach_00156CA8; //Goma left front
		((NJS_OBJECT*)0x9298B4)->model = &attach_00156E90; //Goma right front
		((NJS_OBJECT*)0x92A1CC)->model = &attach_001565D8; //Goma left back
		((NJS_OBJECT*)0x929C94)->model = &attach_00156AC0; //Goma right back
		((NJS_OBJECT*)0x948ACC)->model = &attach_0017BE24; //Rako head
		((NJS_OBJECT*)0x949068)->model = &attach_0017CCE8; //Rako body
		((NJS_OBJECT*)0x9483B4)->model = &attach_0017C980; //Rako tail
		((NJS_OBJECT*)0x948CE4)->model = &attach_0017B6C4; //Rako ear left
		((NJS_OBJECT*)0x948BD8)->model = &attach_0017BAC8; //Rako ear right
		((NJS_OBJECT*)0x948508)->model = &attach_0017B7A8; //Rako whisker left
		((NJS_OBJECT*)0x9486C4)->model = &attach_0017B928; //Rako whisker right
		((NJS_OBJECT*)0x947C78)->model = &attach_0017C2A4; //Rako hand left
		((NJS_OBJECT*)0x947A58)->model = &attach_0017C064; //Rako hand right
		((NJS_OBJECT*)0x947D98)->model = &attach_0017C388; //Rako clam shell
		((NJS_OBJECT*)0x9481A8)->model = &attach_0017C7B0; //Rako foot left
		((NJS_OBJECT*)0x947FB8)->model = &attach_0017C59C; //Rako foot right
		((NJS_OBJECT*)0x942428)->model = &attach_00174864; //Lion face
		((NJS_OBJECT*)0x9427A4)->model = &attach_001744CC; //Lion mane
		((NJS_OBJECT*)0x942EF4)->model = &attach_001756A4; //Lion body
		((NJS_OBJECT*)0x942B78)->model = &attach_00175178; //Lion tail part 1
		((NJS_OBJECT*)0x942A34)->model = &attach_001752C8; //Lion tail part 2
		((NJS_OBJECT*)0x941D08)->model = &attach_00174FD4; //Lion left front
		((NJS_OBJECT*)0x941AF0)->model = &attach_00174DF8; //Lion right front
		((NJS_OBJECT*)0x94190C)->model = &attach_00174C1C; //Lion left back
		((NJS_OBJECT*)0x941728)->model = &attach_00174A40; //Lion right back
		((NJS_OBJECT*)0x942024)->model = &attach_0017427C; //Lion left ear
		((NJS_OBJECT*)0x941EB0)->model = &attach_001740DC; //Lion right ear
	}
	__declspec(dllexport) void __cdecl OnFrame()
	{
		//Chaos 1 puddle
		if (CurrentLevel != 33) ((NJS_MATERIAL*)0x02D64FD8)->attrflags |= NJD_FLAG_IGNORE_LIGHT;
		else ((NJS_MATERIAL*)0x02D64FD8)->attrflags &= ~NJD_FLAG_IGNORE_LIGHT;
		if (CurrentLevel == 20)
		{
			EnvMap1 = 2.0f;
			EnvMap2 = 2.0f;
			EnvMap3 = 0.5f;
			EnvMap4 = 0.5f;
		}
		else
		{
			EnvMap1 = 0.5f;
			EnvMap2 = 0.5f;
			EnvMap3 = 0.5f;
			EnvMap4 = 0.5f;
		}
	}
}


